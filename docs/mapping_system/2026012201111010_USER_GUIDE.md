# File-Step-Module Mapping System - User Guide
**doc_id:** 2026012201111010  
**Created:** 2026-01-22T01:11:41Z  
**Version:** 1.0

---

## Purpose

This system provides deterministic traceability between:
- **Implementation files** (Python, YAML, JSON, MQL4, etc.)
- **Process steps** (trading workflow stages in `updated_trading_process_aligned.yaml`)
- **Modules** (logical boundaries with contract definitions)

## Key Components

### 1. MODULE_REGISTRY
**Location:** `Directory management system/DOD_modules_contracts/2026012201111006_MODULE_REGISTRY_v1.0.0.yaml`

Defines 25 modules with:
- Module ID (e.g., `B1_MT4_ADAPTER_TRANSPORT`)
- Contract boundaries (`in_types`, `out_types`)
- File ownership patterns (`required_files`)
- Steps owned by the module

### 2. FILE_REGISTRY
**Location:** `Directory management system/id_16_digit/registry/2026012201111008_FILE_REGISTRY.json`

Contains 549 files with:
- **doc_id:** Unique 16-digit identifier
- **module_id:** Which module owns this file
- **role:** File's purpose (entrypoint/library/schema/config/test/doc/data/tooling)
- **step_refs:** Which process steps this file implements (entrypoints only)

### 3. Process Document
**Location:** `Directory management system/DOD_modules_contracts/updated_trading_process_aligned.yaml`

Defines 24 process steps with:
- Step number and name
- Module ID (owner)
- Input/output contracts
- (Future) `entrypoint_files`: Which files execute this step

---

## File Roles Explained

| Role | Description | Can Have step_refs? |
|------|-------------|---------------------|
| **entrypoint** | Executes a process step | ‚úÖ Yes |
| **library** | Shared code, imported by entrypoints | ‚ùå No |
| **schema** | Contract definitions (JSON Schema, etc.) | ‚ùå No |
| **config** | Configuration files | ‚ùå No |
| **test** | Unit/integration tests | ‚ùå No |
| **doc** | Documentation files | ‚ùå No |
| **data** | Static data files (matrices, etc.) | ‚ùå No |
| **tooling** | Build scripts, linters, etc. | ‚ùå No |

**Critical Rule:** Only `entrypoint` files can be linked to process steps.

---

## Usage Examples

### Query: Which module owns a file?

```bash
# Using jq
jq '.files[] | select(.filename == "transport_service.py") | .module_id' \
  "Directory management system/id_16_digit/registry/2026012201111008_FILE_REGISTRY.json"
```

Expected: Returns the module_id (e.g., `B1_MT4_ADAPTER_TRANSPORT`)

### Query: What files belong to a module?

```bash
# Find all files in module B1_MT4_ADAPTER_TRANSPORT
jq '.files[] | select(.module_id == "B1_MT4_ADAPTER_TRANSPORT") | .relative_path' \
  "Directory management system/id_16_digit/registry/2026012201111008_FILE_REGISTRY.json"
```

### Query: What role does a file have?

```bash
jq '.files[] | select(.filename == "test_transport.py") | .role' \
  "Directory management system/id_16_digit/registry/2026012201111008_FILE_REGISTRY.json"
```

Expected: Returns `"test"`

### Query: How many entrypoint files exist?

```bash
jq '[.files[] | select(.role == "entrypoint")] | length' \
  "Directory management system/id_16_digit/registry/2026012201111008_FILE_REGISTRY.json"
```

---

## Validation

### Run All Validators

```bash
cd C:\Users\richg\eafix-modular
python scripts\validators\2026012201111009_run_all_validators.py
```

**Expected Output:**
```
‚úÖ PASSED - module_ownership_completeness
‚úÖ PASSED - role_restrictions
‚úÖ PASSED - registry_structure_validation

‚úÖ ALL VALIDATIONS PASSED
```

### Validation Checks

1. **module_ownership_completeness**
   - All files have `module_id`
   - All `module_id` values exist in MODULE_REGISTRY
   - Reports UNCATEGORIZED file count

2. **role_restrictions**
   - All files have valid `role` from allowed enum
   - Only entrypoint files have `step_refs`

3. **registry_structure_validation**
   - Required fields present in all registries
   - Schema versions correct

---

## Current Status (2026-01-22)

### ‚úÖ Completed
- [x] MODULE_REGISTRY created (25 modules)
- [x] FILE_REGISTRY created (549 files)
- [x] Role assignment (all files)
- [x] 3 core validators implemented
- [x] All validations passing

### üöß In Progress
- [ ] Module assignment refinement (currently 100% UNCATEGORIZED)
- [ ] Process document enhancement with `entrypoint_files`
- [ ] Bidirectional linking (step_refs population)

### üìã Planned (Phase B.4-B.6)
- [ ] Manual review of entrypoint assignments
- [ ] Update process YAML with entrypoint_files
- [ ] Populate step_refs in FILE_REGISTRY
- [ ] Generate traceability matrix
- [ ] Pre-commit hooks
- [ ] CI/CD integration

---

## Known Limitations

### Module Assignment
- All 549 files currently assigned `module_id: UNCATEGORIZED`
- Reason: No actual `src/{module_id}/` directory structure exists
- Mitigation: Manual refinement needed based on actual codebase organization

### Step-File Linking
- `step_refs` currently empty for all files
- Reason: Phase B.3-B.4 not yet complete
- Required: Add `entrypoint_files` to process document first

### Contract Validation
- Only validates contract names exist (string matching)
- Does not validate actual schema compliance of implementations
- Future enhancement: Add JSON Schema validation

---

## Troubleshooting

### Issue: Query returns empty result
**Solution:** Check that FILE_REGISTRY path is correct and file exists.

### Issue: Validator reports "FILE_REGISTRY not found"
**Solution:** Run Phase B.2 script to create it:
```bash
python scripts\phase_b\2026012201111007_create_file_registry.py
```

### Issue: All files show UNCATEGORIZED
**Expected:** This is current state. Module assignment requires actual directory structure or manual assignment.

---

## References

- **Mapping Gap Analysis:** `Directory management system/MAPPING_GAP_ANALYSIS.md`
- **Implementation Plan:** `Directory management system/MAPPING_GAP_IMPLEMENTATION_PLAN.md`
- **Mapping Reference:** `Directory management system/DOD_modules_contracts/# Process‚ÜîModule and File‚ÜîStep Mapp.txt`

---

## Support

For issues or questions:
1. Check validation report: `backups/validation_report.json`
2. Review file registry summary: `backups/file_registry_summary.json`
3. Consult implementation plan for phase-specific guidance

**Last Updated:** 2026-01-22T01:11:41Z
