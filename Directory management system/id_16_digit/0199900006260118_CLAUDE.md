# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

**EAFIX Identity System** - A file identity management system that assigns 16-digit numeric ID prefixes to filenames. Files are renamed from `filename.ext` to `1234567890123456_filename.ext`.

**Status**: Production Ready (702 IDs allocated, 100% success rate)

## ID Structure

```
TTNNNSSSSSSSSSSS
││││└─────────┴─ SCOPE (6 digits): Collision domain (fixed: 260118)
│││└──────────── SEQ (5 digits): Monotonic counter (allocated)
││└───────────── NS (3 digits): Namespace code (derived from path)
└┴────────────── TYPE (2 digits): File type code (derived from extension)
```

Example: `2099900001260118_example.py`
- TYPE=20 (Python), NS=999, SEQ=00001, SCOPE=260118

## Essential Commands

```bash
# Scan files and derive identity metadata
python "Enhanced File Scanner v2.py" --identity-config 1299900079260118_IDENTITY_CONFIG.yaml -f csv .

# Allocate single ID
python -c "from core.registry_store import RegistryStore; r = RegistryStore('registry/ID_REGISTRY.json'); print(r.allocate_id('999', '20', 'path/to/file.py', 'YOUR_NAME'))"

# Batch allocate from scan
python 2026011822590002_register_and_allocate.py --csv ../scan_output/file_scan_latest.csv --allocate

# Validate uniqueness
python validation/validate_uniqueness.py ../scan_output/file_scan_latest.csv registry/ID_REGISTRY.json

# Get registry stats
python -c "from core.registry_store import RegistryStore; r = RegistryStore('registry/ID_REGISTRY.json'); print(r.get_stats())"

# Run validation tests
python 2026011820600003_validate_identity_system.py scan_output/file_scan_*.csv
```

## Type Classification (1299900079260118_IDENTITY_CONFIG.yaml)

| Extension | Type Code | Extension | Type Code |
|-----------|-----------|-----------|-----------|
| .md | 01 | .py | 20 |
| .txt | 02 | .ps1 | 21 |
| .csv | 10 | .mq4 | 22 |
| .json | 11 | .db | 30 |
| .yaml/.yml | 12 | .png | 41 |
| .jsonl | 13 | .html | 43 |
| * (fallback) | 00 | | |

## Namespace Routing (from path)

| Path Pattern | NS Code | Description |
|--------------|---------|-------------|
| docs/**/* | 100 | Documentation |
| data/**/* | 110 | Data files |
| scripts/python/**/* | 200 | Python scripts |
| reports/**/* | 420 | Reports |
| **/* | 999 | Uncategorized (fallback) |

## Key Files

```
Enhanced File Scanner v2.py      # Main scanner (Python 3.11+)
1299900079260118_IDENTITY_CONFIG.yaml             # ID structure and derivation rules
registry/ID_REGISTRY.json        # 702 allocated IDs
registry/identity_audit_log.jsonl # Complete audit trail
core/registry_store.py           # Registry implementation
validation/                      # Uniqueness and sync validators
```

## CSV Output Schema (26 columns)

**Identity Fields**: doc_id, has_id_prefix, current_id_prefix, needs_id, planned_id, planned_rel_path
**Derived Values**: type_code, ns_code, scope
**File Info**: relative_path, path, name, extension, size_bytes, mtime_utc, content_hash

## Collision Policy

- `on_id_exists`: abort_run
- `on_path_exists`: abort_run
- `on_hash_duplicate`: unique_ids (same content gets unique IDs)

## Dependencies

- Python 3.11+
- PyYAML (`pip install pyyaml`)
