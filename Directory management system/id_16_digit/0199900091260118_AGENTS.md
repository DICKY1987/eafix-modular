# Repository Guidelines

## Project Structure & Module Organization
This repo hosts the modular EAFIX trading system. Service code lives under `services\<service>\src` (for example, `services\data-ingestor\src\main.py`). Tests live in `services\<service>\tests` with `unit` and `integration` subfolders. Shared helpers are in `services\common`. Deployment artifacts are under `deploy\compose`, observability config under `observability`, and operational runbooks under `docs\runbooks`. Top-level tooling includes `pyproject.toml`, `Makefile`, and `Taskfile.yml`.

### Identity System (id_16_digit/)
The `id_16_digit` directory contains the identity management system including:
- **Enhanced File Scanner v2.py**: Configurable file scanner with YAML-driven type/namespace derivation
- **IDENTITY_CONFIG.yaml**: Configuration for 16-digit ID structure (type_code, ns_code, scope)
- **Validation Tools**: Automated testing scripts to verify ID derivation correctness
- **Documentation**: Implementation reports, quick start guides, and technical specifications

**Status**: Production-ready (completed 2026-01-18). Scanner generates 26-column CSV with derived identity fields.

## Build, Test, and Development Commands
- `poetry install`: Install dependencies for local development.
- `poetry run pytest`: Run the full test suite.
- `poetry run pytest -m "unit" services\data-ingestor\tests\unit -q`: Run a focused unit subset.
- `make docker-up` / `make docker-down`: Start or stop the local Docker Compose stack.
- `make lint`: Run Flake8 + mypy over `services\*\src`.
- `make format`: Run Black + isort over `services\`.
- **Identity System**: `python "id_16_digit\Enhanced File Scanner v2.py" --identity-config "id_16_digit\IDENTITY_CONFIG.yaml" -f csv .` - Scan files and derive identity metadata.
- **Validate Identity**: `python "id_16_digit\2026011820600003_validate_identity_system.py" scan_output\file_scan_*.csv` - Validate scanner output correctness.

## Coding Style & Naming Conventions
Python 3.11 is required. Use 4-space indentation and Black formatting (line length 88). isort uses the Black profile; Flake8 and mypy run in strict mode. Naming follows `snake_case` for modules/functions, `PascalCase` for classes, and `UPPER_CASE` for constants. Keep service APIs small and typed; prefer pure functions in `src` with thin FastAPI adapters.

## Testing Guidelines
Testing uses `pytest` with markers: `unit`, `integration`, `e2e`, `security`, `performance`. Tests must be deterministic; unit tests should not hit real network or databases. Name files `test_*.py`. Coverage target is at least 80% with branch coverage; reports go under `reports\coverage`.

## Commit & Pull Request Guidelines
Use Conventional Commits: `feat`, `fix`, `docs`, `chore`, `ci`, `refactor` with optional scope (for example, `feat(risk-manager): add position limiter`). Keep subjects imperative and under 72 characters; explain what and why in the body. PRs should include a clear description, linked issues (for example, `Fixes #123`), test evidence, and note any config/DB/port changes. Include UI screenshots for dashboard changes.

## Security & Configuration Tips
Never commit secrets. Use `.env.template` as the starting point for local environment files. Images are pinned by digest; update them only when bumping base images. Services typically expose ports 8081â€“8087; verify health endpoints at `/healthz` and `/readyz` after `make docker-up`.
