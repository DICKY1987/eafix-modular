# EAFIX Identity System

**Status**: âœ… Production Ready  
**Last Updated**: 2026-01-22  
**Version**: 2.1 (Hardening Release)

## Overview

The EAFIX Identity System provides configurable, YAML-driven file identification with 16-digit numeric IDs structured as `TYPE-NS-SEQ-SCOPE`.

## Recent Updates

### Version 2.1 (2026-01-21/22) - Hardening Release ðŸŽ‰
- âœ… **Atomic registry updates** with `derive --apply` (automatic backup + idempotent)
- âœ… **CSV/SQLite export** for analysis and reporting
- âœ… **Module assignment validator** with precedence chain (opt-in)
- âœ… **Process validation validator** for workflow mapping (opt-in)
- âœ… **34/34 tests passing** (100% test coverage)

**Key Benefits**: Deterministic operations, safe updates, queryable exports, enhanced validation

See: `HARDENING_COMPLETION_SUMMARY.md` for details

## Quick Start

### Basic Scanning
```bash
# Scan files and derive identity metadata
python "Enhanced File Scanner v2.py" --identity-config IDENTITY_CONFIG.yaml -f csv .

# Validate output
python 2026011820600003_validate_identity_system.py scan_output/file_scan_*.csv
```

### Registry Operations (v2.1)
```bash
# Validate registry
python automation/2026012120420011_registry_cli.py validate --strict

# Apply derivations atomically (with backup)
python automation/2026012120420011_registry_cli.py derive --apply

# Export to SQLite for analysis
python automation/2026012120420011_registry_cli.py export --format sqlite --output registry.sqlite

# Export to CSV
python automation/2026012120420011_registry_cli.py export --format csv --output registry.csv
```

See: `HARDENING_QUICK_REFERENCE.md` for complete command reference

## Files

### Core System
- **Enhanced File Scanner v2.py** - Configurable file scanner (Python 3.11+)
- **IDENTITY_CONFIG.yaml** - Configuration for ID structure and derivation rules
- **automation/2026012120420011_registry_cli.py** - Registry operations CLI

### Documentation
- **2026011820600002_QUICK_START_GUIDE.md** - User guide with examples
- **HARDENING_QUICK_REFERENCE.md** - Quick CLI commands
- **docs/2026012120420018_REGISTRY_OPERATIONS_RUNBOOK.md** - Operations guide
- **docs/id_16_digit_SYSTEM_DOCUMENTATION.md** - Comprehensive system doc

### Hardening Features (v2.1)
- **HARDENING_COMPLETION_SUMMARY.md** - Implementation summary
- **validation/2026012120460001_validate_module_assignment.py** - Module validator
- **validation/2026012120460002_validate_process.py** - Process validator

### Registry & Policies
- **registry/2026012012410001_SINGLE_UNIFIED_SSOT_REGISTRY_SPEC.md** - Registry spec v2.1
- **registry/2026012014470004_REGISTRY_V2.1_QUICK_REFERENCE.md** - Schema reference
- **contracts/2026012120420001_UNIFIED_SSOT_REGISTRY_WRITE_POLICY.yaml** - Write policy
- **contracts/2026012120420002_UNIFIED_SSOT_REGISTRY_DERIVATIONS.yaml** - Derivation formulas

### Testing & Validation
- **tests/2026012120460003_test_derive_apply.py** - Atomic update tests (5/5 passing)
- **tests/2026012120460004_test_export.py** - Export tests (5/5 passing)
- **tests/2026012120460005_test_validators.py** - Validator tests (10/10 passing)

### Specifications
- **FILE_SCAN_CSV_DERIVATION_SPEC.txt** - CSV schema specification
- **16_DIGIT_ID_BREAKDOWN.md** - ID structure details
- **SEQ_ALLOCATOR_SPEC.md** - Allocator specification

## ID Structure

```
TTNNNSSSSSSSSSSS
â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚
â”‚â”‚â”‚â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€ SCOPE (6 digits): Collision domain (260118)
â”‚â”‚â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SEQ (5 digits): Monotonic counter (allocated)
â”‚â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ NS (3 digits): Namespace code (derived from path)
â””â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TYPE (2 digits): File type code (derived from extension)
```

## Configuration

### Type Classification

| Extension | Type Code | Description |
|-----------|-----------|-------------|
| .md | 01 | Markdown |
| .txt | 02 | Text |
| .csv | 10 | CSV Data |
| .json | 11 | JSON |
| .yaml, .yml | 12 | YAML |
| .py | 20 | Python |
| .ps1 | 21 | PowerShell |
| * | 00 | Unknown/Fallback |

### Namespace Routing

| Path Pattern | NS Code | Description |
|--------------|---------|-------------|
| docs/**/* | 100 | Documentation |
| data/**/* | 110 | Data files |
| scripts/python/**/* | 200 | Python scripts |
| reports/**/* | 420 | Reports |
| **/* | 999 | Uncategorized (fallback) |

## CSV Output Schema

The scanner generates CSV with 26 columns:

**Scan Metadata**: scan_id, scan_root, first_seen_utc  
**File Info**: relative_path, path, name, extension, size_bytes, mtime_utc, created_time, is_directory  
**System Metadata**: mime_type, permissions, content_hash  
**Identity Fields**: doc_id, has_id_prefix, current_id_prefix, needs_id, 0000000000000000_filename  
**Derived Values**: type_code, ns_code, scope  
**Planning Fields**: planned_id, planned_rel_path  
**Error Tracking**: error, error_kind

## Usage Examples

### Basic Scan
```bash
python "Enhanced File Scanner v2.py" --identity-config IDENTITY_CONFIG.yaml -f csv C:\my\project
```

### Filtered Scan
```bash
# Only files â‰¤ 10MB
python "Enhanced File Scanner v2.py" --identity-config IDENTITY_CONFIG.yaml -f csv --max-size 10485760 .
```

### Validate Output
```bash
python 2026011820600003_validate_identity_system.py scan_output/file_scan_20260118_150743.csv
```

## Validation Tests

The validation script runs 6 automated tests:

1. âœ… **CSV Schema**: Verifies 26 columns with correct names
2. âœ… **Type Derivation**: Checks extension â†’ type_code mapping
3. âœ… **Namespace Routing**: Verifies path â†’ ns_code derivation
4. âœ… **Scope Consistency**: Ensures all rows have scope=260118
5. âœ… **ID Detection**: Validates existing ID prefix detection
6. âœ… **Required Fields**: Confirms all mandatory fields populated

## Implementation Status

| Issue | Description | Status |
|-------|-------------|--------|
| #1 | Scanner doesn't load config | âœ… FIXED |
| #2 | ID structure ambiguity | âœ… FIXED |
| #3 | Function codes orphaned | âœ… RESOLVED |
| #4 | No config validation | âœ… FIXED |
| #5 | Counter store undefined | âœ… FIXED |
| #6 | No collision detection | âœ… DEFINED |
| #7 | No resume for Phase 1/2 | ðŸ“‹ FUTURE |
| #8 | No error recovery | âœ… FIXED |
| #9 | Multi-project guidance | âœ… FIXED |
| #10 | No schema evolution | âœ… FIXED |
| #11 | Hardcoded type_code | âœ… FIXED |
| #12 | Hardcoded ns_code | âœ… FIXED |
| #13 | Missing CSV columns | âœ… FIXED |

**Total**: 11/13 fixed, 2 deferred to future phases

## Dependencies

- Python 3.11+
- PyYAML (`pip install pyyaml`)
- Standard library: csv, pathlib, dataclasses, argparse

## Support & Documentation

- **Quick Start**: See `2026011820600002_QUICK_START_GUIDE.md`
- **Implementation Details**: See `2026011820600001_IMPLEMENTATION_REPORT.md`
- **Executive Summary**: See `2026011820600004_EXECUTIVE_SUMMARY.md`

## License

Internal EAFIX project - not for external distribution.

---

**Project**: EAFIX Modular Trading System  
**Module**: Identity Management (id_16_digit)  
**Completion Date**: 2026-01-18  
**Status**: Production Ready âœ…
