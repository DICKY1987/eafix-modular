{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/indicator_record.schema.json",
  "title": "IndicatorRecord",
  "type": "object",
  "required": [
    "IndicatorID",
    "Concept",
    "Indicator_Computation",
    "Signal_Logic",
    "OutputType",
    "Thresholds",
    "Inputs"
  ],
  "additionalProperties": false,
  "properties": {
    "IndicatorID": {
      "type": "string",
      "minLength": 3,
      "pattern": "^[A-Z0-9_]+$",
      "description": "Stable unique identifier, use UPPER_SNAKE_CASE (e.g., FRI_MOVE_PCT)."
    },
    "Concept": {
      "type": "string",
      "minLength": 3
    },
    "Indicator_Computation": {
      "type": "string",
      "minLength": 3,
      "description": "Human-readable computation spec."
    },
    "Signal_Logic": {
      "type": "string",
      "minLength": 3,
      "description": "Human-readable signal rules/conditions."
    },
    "OutputType": {
      "type": "string",
      "enum": [
        "z_score",
        "probability_0_1",
        "state_enum",
        "boolean",
        "raw_value",
        "scalar_0_100",
        "pips",
        "percent"
      ],
      "description": "Normalization/type of indicator output"
    },
    "Thresholds": {
      "oneOf": [
        {
          "title": "Z-Score Threshold",
          "type": "object",
          "required": [
            "kind",
            "gte"
          ],
          "properties": {
            "kind": {
              "const": "zscore"
            },
            "gte": {
              "type": "number"
            },
            "lte": {
              "type": "number"
            },
            "hysteresis": {
              "type": "number",
              "default": 0.0
            },
            "persistence_bars": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "direction": {
              "type": "string",
              "enum": [
                "risk_on",
                "risk_off",
                "both"
              ],
              "default": "both"
            }
          },
          "additionalProperties": true
        },
        {
          "title": "Oscillator Band",
          "type": "object",
          "required": [
            "kind",
            "upper",
            "lower"
          ],
          "properties": {
            "kind": {
              "const": "band"
            },
            "upper": {
              "type": "number"
            },
            "lower": {
              "type": "number"
            },
            "hysteresis": {
              "type": "number",
              "default": 0.0
            },
            "persistence_bars": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            }
          },
          "additionalProperties": true
        },
        {
          "title": "Percent Change (Time-Window)",
          "type": "object",
          "required": [
            "kind",
            "abs_change_gte",
            "window"
          ],
          "properties": {
            "kind": {
              "const": "percent_change"
            },
            "abs_change_gte": {
              "type": "number"
            },
            "direction": {
              "type": "string",
              "enum": [
                "up",
                "down",
                "both"
              ],
              "default": "both"
            },
            "one_shot": {
              "type": "boolean",
              "default": false
            },
            "window": {
              "type": "object",
              "required": [
                "tz",
                "start",
                "end",
                "days"
              ],
              "properties": {
                "tz": {
                  "type": "string"
                },
                "start": {
                  "type": "string",
                  "pattern": "^\\d{2}:\\d{2}$"
                },
                "end": {
                  "type": "string",
                  "pattern": "^\\d{2}:\\d{2}$"
                },
                "days": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "minItems": 1
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": true
        }
      ]
    },
    "Inputs": {
      "type": "object",
      "description": "Machine-usable inputs",
      "properties": {
        "symbol_scope": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "timeframe": {
          "type": "string"
        },
        "price_source": {
          "type": "string"
        },
        "external_series": {
          "type": "string"
        },
        "provider": {
          "type": "string"
        },
        "resample": {
          "type": "string"
        },
        "transform": {
          "type": "string"
        },
        "components": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "blend": {
          "type": "string"
        },
        "weights": {
          "type": "object",
          "additionalProperties": {
            "type": "number"
          }
        },
        "update_freq": {
          "type": "string"
        },
        "offsets": {
          "type": "object",
          "additionalProperties": true
        },
        "notes": {
          "type": "string"
        }
      },
      "additionalProperties": true
    },
    "Notes": {
      "type": "string"
    }
  }
}