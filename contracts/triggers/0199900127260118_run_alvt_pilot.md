# ALVT Pilot Runbook
# doc_id: 0199900127260118

**Created:** 2026-01-23T19:05:00Z  
**Version:** 1.0  
**Trigger:** FILE_IDENTITY_CREATE  

## Purpose

This runbook documents the exact commands and expected outputs for running ALVT (Automation Lifecycle Verification Tooling) verification on the FILE_IDENTITY_CREATE pilot trigger.

## Prerequisites

### Environment
- Python 3.8 or higher
- pytest installed (`pip install pytest`)
- PyYAML installed (`pip install pyyaml`)
- Repository cloned and up-to-date

### Directory Structure Verification
```bash
# Verify required directories exist
ls contracts/triggers/
ls tools/alvt/
ls reports/alvt/
ls tests/
```

Expected: All directories should exist.

## Verification Workflow

### Step 1: Contract Validation

**Command:**
```bash
python tools/alvt/2099900119260118_validate_contract.py --trigger FILE_IDENTITY_CREATE
```

**Expected Output:**
```
Validating contract: <repo>/contracts/triggers/0199900118260118_trigger.FILE_IDENTITY_CREATE.yaml
VALID
```

**Exit Code:** 0

**What This Checks:**
- Contract file exists
- YAML is well-formed
- All required sections present (metadata, required_files, required_nodes, etc.)
- Required fields populated
- Graph consistency (edges reference declared nodes)

**If FAIL:**
- Check contract file path and name
- Validate YAML syntax
- Review error messages for missing required fields

---

### Step 2: Layer 0 Static Integrity Verification

**Command:**
```bash
python tools/alvt/2099900121260118_layer0_static.py --trigger FILE_IDENTITY_CREATE
```

**Expected Output:**
```
Layer 0 verification: PASS
Report written to: <repo>/reports/alvt/static.FILE_IDENTITY_CREATE.json
Checks: 14/14 passed
```

**Exit Code:** 0

**What This Checks:**
- All 6 required files exist (identity_pipeline.py, orchestrator.py, watcher.py, queue.py, validators.py, config.py)
- All 4 required config keys accessible (identity.mode, identity.dry_run, watcher.enabled, watcher.paths)
- No forbidden patterns found (TODO, FIXME, NotImplementedError, stub markers)

**Report Location:**
`reports/alvt/static.FILE_IDENTITY_CREATE.json`

**If FAIL:**
- Review report JSON for failed checks
- Check `reason` field in failed checks for details
- Verify file paths in contract match actual repository structure
- Look for forbidden patterns in `evidence.findings`

---

### Step 3: Layer 1 Graph Connectivity Verification

**Command:**
```bash
python tools/alvt/2099900122260118_layer1_graph.py --trigger FILE_IDENTITY_CREATE
```

**Expected Output:**
```
Layer 1 verification: PASS
Report written to: <repo>/reports/alvt/graph.FILE_IDENTITY_CREATE.json
Checks: 14/14 passed
```

**Exit Code:** 0

**What This Checks:**
- All 7 required nodes discovered (watcher, orchestrator, queue, identity handler, methods)
- All 6 required edges verified (watcher→queue→orchestrator→handler→methods→validator)
- No orphaned nodes (all reachable from entrypoint)

**Report Location:**
`reports/alvt/graph.FILE_IDENTITY_CREATE.json`

**If FAIL:**
- Review report JSON for failed checks
- Check `node_exists_*` checks for missing classes/functions/methods
- Verify node locations in contract match actual code structure
- Check `edge_exists_*` for missing call relationships

---

### Step 4: Run All Tests

**Command:**
```bash
pytest tests/2099900123260118_test_alvt_layer0.py tests/2099900124260118_test_alvt_layer1.py -v
```

**Expected Output:**
```
================================ test session starts =================================
...
tests/2099900123260118_test_alvt_layer0.py::test_layer0_file_exists_pass PASSED
tests/2099900123260118_test_alvt_layer0.py::test_layer0_file_missing_fail PASSED
... (15 tests total)
================================ 15 passed in 0.5s ==================================
```

**Exit Code:** 0

**What This Checks:**
- ALVT tools work correctly in isolated test environments
- Layer 0 detects file existence/absence correctly
- Layer 0 detects forbidden patterns correctly
- Layer 1 discovers nodes and edges correctly
- Report structure is valid and deterministic

**If FAIL:**
- Review test output for specific failing test
- Check test assertions vs actual behavior
- Verify test fixtures are correctly set up

---

## Unified CLI (Alternative Method)

### Run All Steps at Once

**Command:**
```bash
python tools/alvt/2099900126260118_alvt_cli.py verify --trigger FILE_IDENTITY_CREATE
```

**Expected Output:**
```
Running full ALVT verification for trigger: FILE_IDENTITY_CREATE
============================================================

Step 1: Contract Validation
------------------------------------------------------------
Validating contract: ...
VALID
✅ Contract validation PASSED

Step 2: Layer 0 (Static Integrity)
------------------------------------------------------------
Layer 0 verification: PASS
Report written to: ...
Checks: 14/14 passed
✅ Layer 0 verification PASSED

Step 3: Layer 1 (Graph Connectivity)
------------------------------------------------------------
Layer 1 verification: PASS
Report written to: ...
Checks: 14/14 passed
✅ Layer 1 verification PASSED

============================================================
✅ All verification steps PASSED for FILE_IDENTITY_CREATE
============================================================
```

**Exit Code:** 0

---

## Stability Verification

To confirm deterministic, repeatable results:

**Commands:**
```bash
# Run 1
python tools/alvt/2099900121260118_layer0_static.py --trigger FILE_IDENTITY_CREATE
python tools/alvt/2099900122260118_layer1_graph.py --trigger FILE_IDENTITY_CREATE

# Run 2 (immediately after, no changes)
python tools/alvt/2099900121260118_layer0_static.py --trigger FILE_IDENTITY_CREATE
python tools/alvt/2099900122260118_layer1_graph.py --trigger FILE_IDENTITY_CREATE
```

**Expected:**
Both runs should produce:
- Identical check results (passed/failed status)
- Identical check counts
- Same PASS/FAIL overall status
- Only timestamps should differ

---

## Viewing Reports

### Layer 0 Report
```bash
cat reports/alvt/static.FILE_IDENTITY_CREATE.json | python -m json.tool
```

**Key Sections:**
- `status`: "PASS" or "FAIL"
- `summary.passed`: Number of passed checks
- `summary.failed`: Number of failed checks
- `checks[]`: Array of individual check results

### Layer 1 Report
```bash
cat reports/alvt/graph.FILE_IDENTITY_CREATE.json | python -m json.tool
```

**Key Sections:**
- `status`: "PASS" or "FAIL"
- `graph_discovery.nodes_discovered`: Number of nodes found in codebase
- `graph_discovery.edges_discovered`: Number of edges found
- `checks[]`: Array of node/edge verification results

---

## Troubleshooting

### Issue: Contract file not found

**Symptom:**
```
ERROR: Contract file not found for trigger 'FILE_IDENTITY_CREATE'
```

**Solution:**
```bash
# Verify contract file exists and has correct naming
ls -la contracts/triggers/*FILE_IDENTITY_CREATE*
# Expected: 0199900118260118_trigger.FILE_IDENTITY_CREATE.yaml
```

### Issue: Python module not found

**Symptom:**
```
ModuleNotFoundError: No module named 'yaml'
```

**Solution:**
```bash
pip install pyyaml
```

### Issue: Layer 0 reports config checks as placeholder

**Symptom:**
Config checks pass but have note "Config validation not yet implemented"

**Solution:**
This is expected for the pilot. Config validation is a documented placeholder. See findings log: `reports/alvt/0199900125260118_alvt_pilot_findings.md`

### Issue: Layer 1 reports simplified edge verification

**Symptom:**
Edge checks pass but have note "Simplified edge verification"

**Solution:**
This is expected for the pilot. Full call-graph analysis is deferred. See findings log for details.

---

## Success Criteria

All of the following must be true:

- [x] Contract validation passes (exit 0)
- [x] Layer 0 produces PASS report
- [x] Layer 1 produces PASS report
- [x] All pytest tests pass
- [x] Two consecutive runs produce identical results (except timestamps)
- [x] No manual intervention required between runs

---

## Next Steps After Successful Verification

1. Review findings log: `reports/alvt/0199900125260118_alvt_pilot_findings.md`
2. Proceed to Phase 6 (baseline freeze and backlog creation)
3. Consider adding additional triggers using template: `contracts/triggers/0199900117260118_trigger_contract_template.yaml`

---

## Maintenance

### When to Re-run Verification

- After modifying any file in `repo_autoops/` (watcher, orchestrator, identity_pipeline, queue, validators, config)
- After updating the FILE_IDENTITY_CREATE contract
- Before deploying changes to file identity automation
- As part of CI/CD pipeline (recommended)

### Updating This Runbook

When ALVT tools are enhanced:
- Update command examples with new options
- Update expected output samples
- Document new verification layers (Layer 2+)
- Add new troubleshooting scenarios

---

## References

- Architecture: `contracts/triggers/0199900116260118_automation_verification_architecture.md`
- Contract Template: `contracts/triggers/0199900117260118_trigger_contract_template.yaml`
- Findings Log: `reports/alvt/0199900125260118_alvt_pilot_findings.md`
- Pilot Selection: `contracts/triggers/pilot_trigger_selection.md`
