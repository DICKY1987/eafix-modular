# Re-entry Decisions CSV Schema

## Description
Trading re-entry decisions generated by the re-entry engine based on trade outcomes and matrix parameters.

## File Format
- **File naming**: `reentry_decisions_YYYYMMDD_HHMMSS.csv`
- **Encoding**: UTF-8
- **Delimiter**: Comma (`,`)
- **Header**: Required (first row)

## Required Columns

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| `file_seq` | Integer | Monotonic sequence number for ordering | 1, 2, 3, ... |
| `checksum_sha256` | String | SHA-256 checksum of row data (excluding this field) | `a1b2c3d4e5f6...` |
| `timestamp` | ISO 8601 | Decision timestamp in UTC | `2024-09-10T14:30:00Z` |
| `trade_id` | String | Original trade identifier | `TRADE_20240910_001` |
| `hybrid_id` | String | Hybrid reentry identifier | `O_DUR5_PROX2_HIGH_BUY` |
| `symbol` | String | Currency pair | `EURUSD`, `GBPJPY` |
| `outcome_class` | String | Trade outcome classification | `WIN`, `LOSS`, `BREAKEVEN` |
| `duration_class` | String | Trade duration classification | `QUICK`, `NORMAL`, `EXTENDED` |
| `reentry_action` | String | Recommended action | `R1`, `R2`, `HOLD`, `NO_REENTRY` |
| `parameter_set_id` | String | Applied parameter set identifier | `PS_EURUSD_HIGH_001` |
| `resolved_tier` | String | Fallback tier used | `EXACT`, `TIER1`, `TIER2`, `TIER3`, `GLOBAL` |
| `chain_position` | String | Position in O→R1→R2 chain | `O`, `R1`, `R2` |
| `lot_size` | Float | Recommended lot size | `0.01`, `0.1`, `1.0` |
| `stop_loss` | Float | Stop loss in pips | `20.0`, `50.0` |
| `take_profit` | Float | Take profit in pips | `40.0`, `100.0` |

## Constraints
- `file_seq` must be monotonically increasing within file
- `checksum_sha256` must match computed SHA-256 of row data
- `hybrid_id` must follow Hybrid ID format specification
- `chain_position` sequence must respect O→R1→R2 progression
- `resolved_tier` must be one of: EXACT, TIER1, TIER2, TIER3, GLOBAL

## Chain Enforcement
- Maximum one R1 and one R2 per original trade (O)
- R1 can only follow O, R2 can only follow R1
- Chain ledger tracks active chains to prevent violations

## Atomic Write Policy
1. Write to temporary file with `.tmp` extension
2. Compute SHA-256 for each row (excluding checksum column)
3. Call `fsync()` to ensure data is written to disk
4. Rename from `.tmp` to final filename atomically